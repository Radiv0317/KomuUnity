<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-600">
    <!-- Main content -->
    <div class="container">
        <div class="flex grid-cols-1 md:grid-cols-2 gap-8">
            <!-- Sidebar -->
            <nav id="sidebar" class="col-span-1 bg-gray-900 px-10 shadow-lg text-white">
                <div class="sticky top-4">
                    <a href="#" class="navbar-brand px-10">
                        <img src="{{ url_for('static', filename='images/KOMUUNITY3.png') }}" alt="KOMUUNITY" width="100">
                    </a>
                    <ul class="flex flex-col space-y-8 class= mx-10">
                        <li>
                            <a href="#" class="nav-link active mb-4 flex items-center space-x-4">
                                <svg xmlns="http://www.w3.org/2000/svg" width="30" fill="currentColor"
                                    class="bi bi-house-door-fill" viewBox="0 0 16 16">
                                    <path
                                        d="M6.5 14.5v-3.505c0-.245.25-.495.5-.495h2c.25 0 .5.25.5.5v3.5a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5" />
                                </svg>
                                <span>Home</span>
                            </a>
                        </li>
                        <li>
                            <a href="{{ url_for('create_threads') }}"
                                class="nav-link mb-4 flex items-center space-x-4">
                                <svg xmlns="http://www.w3.org/2000/svg" width="30" fill="currentColor"
                                    class="bi bi-plus-square-fill" viewBox="0 0 16 16">
                                    <path
                                        d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm6.5 4.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3a.5.5 0 0 1 1 0" />
                                </svg>
                                <span>Create Thread</span>
                            </a>
                        </li>
                        <li>
                            <a href="{{ url_for('search_users') }}"
                                class="nav-link mb-4 flex items-center space-x-4">
                                <svg xmlns="http://www.w3.org/2000/svg" width="30" fill="currentColor"
                                    class="bi bi-person-fill-add" viewBox="0 0 16 16">
                                    <path
                                        d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7m.5-5v1h1a.5.5 0 0 1 0 1h-1v1a.5.5 0 0 1-1 0v-1h-1a.5.5 0 0 1 0-1h1v-1a.5.5 0 0 1 1 0m-2-6a3 3 0 1 1-6 0 3 3 0 0 1 6 0" />
                                    <path
                                        d="M2 13c0 1 1 1 1 1h5.256A4.5 4.5 0 0 1 8 12.5a4.5 4.5 0 0 1 1.544-3.393Q8.844 9.002 8 9c-5 0-6 3-6 4" />
                                </svg>
                                <span>Search Users</span>
                            </a>
                        </li>
                        <li>
                            <a href="{{ url_for('conversations') }}"
                                class="nav-link mb-4 flex items-center space-x-4">
                                <svg xmlns="http://www.w3.org/2000/svg" width="30" fill="currentColor"
                                    class="bi bi-chat-fill" viewBox="0 0 16 16">
                                    <path
                                        d="M8 15c4.418 0 8-3.134 8-7s-3.582-7-8-7-8 3.134-8 7c0 1.76.743 3.37 1.97 4.6-.097 1.016-.417 2.13-.771 2.966-.079.186.074.394.273.362 2.256-.37 3.597-.938 4.18-1.234A9 9 0 0 0 8 15" />
                                </svg>
                                <span>Conversations</span>
                            </a>
                        </li>
                        <li>
                            <a href="{{ url_for('profile') }}"
                            class="nav-link mb-4 flex items-center space-x-1">

                            {% if current_user.profile_picture %}
                                <img src="{{ url_for('static', filename='images/' + current_user.profile_picture) }}" alt="Profile Picture" class="rounded-full w-10 h-10 mr-2">
                            {% else %}
                                <img src="{{ url_for('static', filename='images/default_profile_picture.png') }}" alt="Default Profile Picture" class="rounded-full w-10 h-10 mr-2">
                            {% endif %}

                                <span>{{ current_user.username }}</span>
                            </a>
                        </li>
                        <li>
                            <a href="{{ url_for('logout') }}"
                            class="nav-link mb-4 flex items-center space-x-4">

                            <svg xmlns="http://www.w3.org/2000/svg" width="30" fill="#db0f00" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0z"/>
                                <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708z"/>
                              </svg>

                                <span class="text-red-500">Logout</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Main content -->
            <main class="col-span mt-8 mx-auto mb-5 main-content text-white">
                <div class="grid grid-cols gap-8">
                    {% for thread in threads %}
                    <div class="bg-gray-900 rounded-lg w-[50rem] shadow-md p-6">
                        <div class="flex items-center">
                            {% if thread.user.profile_picture %}
                              <img src="{{ url_for('static', filename='images/' + thread.user.profile_picture) }}" alt="Profile Picture" class="rounded-full w-[4rem] mr-4">
                            {% else %}
                              <img src="{{ url_for('static', filename='images/default_profile_picture.png') }}" alt="Default Profile Picture" class="rounded-full w-[4rem] mr-4">
                            {% endif %}
                            <a href="{{ url_for('user_profile', username=thread.user.username) }}"><p>{{ thread.user.username }}</p></a>
                          </div>
                        <h3 class="text-xl font-semibold mb-5 mt-5">{{ thread.title }}</h3>
                        <p class="text-gray mb-5">{{ thread.content }}</p>
                        {% if thread.image_filename %}
                        <div class="w-full flex justify-center">
                            <img src="{{ url_for('static', filename='images/' + thread.image_filename) }}"
                            alt="Thread Image" class="mt-4">
                        </div>
                        {% endif %}
                        <div class="flex justify-between items-center mt-4">
                            <p class="text-gray-500 text-sm">{{ thread.created_at.strftime('%Y-%m-%d %H:%M:%S') }}
                            </p>
                            <div class="justify-end flex gap-3">
                                <a href="{{ url_for('view_thread', thread_id=thread.id) }}"
                                    class="text-white-500 font-semibold py-2 px-4">View Thread</a>
                                <button onclick="copyImageUrl()" id="share-button" class="text-blue-500 font-semibold py-2 px-4">Share</button>
                                {% if current_user == thread.user %}
                                <form method="post" action="{{ url_for('delete_thread', thread_id=thread.id) }}">
                                    {{ csrf_token }}
                                    <button type="submit"
                                        class="text-red-500 font-semibold py-2 px-4"
                                        onclick="return confirm('Are you sure you want to delete this thread?')">Delete
                                        Thread</button>
                                </form>
                                <a href="{{ url_for('edit_thread_route', thread_id=thread.id) }}"
                                    class="text-blue-500 font-semibold py-2 px-4">Edit Thread</a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </main>
        </div>
    </div>

    <script>
        // Function to prevent using "back" button
        // Mendeteksi perangkat mobile atau desktop
        function detectDevice() {
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            return isMobile ? 'mobile' : 'desktop';
        }

        // Contoh penggunaan
        const deviceType = detectDevice();
        console.log('Device type:', deviceType);

        // Jika pengguna adalah perangkat mobile dan memilih untuk tetap masuk
        if (deviceType === 'mobile') {
            const confirmStay = confirm('Anda menggunakan perangkat mobile. Tetap masuk ke website?');
            if (!confirmStay) {
                window.location.href = 'logout'; // Ganti dengan URL logout Anda
            }
        }
        
        function disableBack() {
            window.history.forward();
        }
        disableBack();

        // Monitoring page changes
        window.onload = disableBack;
        window.onpageshow = function (evt) {
            if (evt.persisted) disableBack();
        };

        function confirmLogout() {
            var confirmation = confirm("Are you sure you want to logout?");
            if (confirmation) {
                // If user clicks OK, redirect to logout page
                window.location.href = "/logout";
            }
        }

         // Toggle dropdown menu
    document.addEventListener('DOMContentLoaded', function() {
        const menuButton = document.getElementById('menu-button');
        const menuDropdown = document.querySelector('.relative .absolute');

        menuButton.addEventListener('click', function() {
            menuDropdown.classList.toggle('hidden');
        });

        // Hide dropdown menu when clicking outside
        document.addEventListener('click', function(event) {
            const isClickInside = menuButton.contains(event.target) || menuDropdown.contains(event.target);
            if (!isClickInside) {
                menuDropdown.classList.add('hidden');
            }
        });
    });
    document.addEventListener('contextmenu', function(e) {
        var clickedElement = e.target;
        if (clickedElement.tagName === 'IMG') {
            e.preventDefault();
            const modal = document.createElement('div');
            modal.innerHTML = `
                <div style="background-color: rgba(0, 0, 0, 0.8); position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center;">
                    <div style="background-color: #333; color: white; padding: 30px; border-radius: 10px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);">
                        <p style="font-size: 20px; text-align: center;">You can't download image, try copy it and share</p>
                        <button style="position: absolute; top: 10px; right: 10px; color: white; padding: 5px 10px; border: none; border-radius: 3px; cursor: pointer;" onclick="document.body.removeChild(modal);"><svg xmlns="http://www.w3.org/2000/svg" width="40"  fill="currentColor" class="bi bi-x" viewBox="0 0 16 16">
                        <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
                        </svg></button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            // Add script to handle closing the modal
            modal.querySelector('button').addEventListener('click', function() {
                document.body.removeChild(modal);
            });
        }
    });
    // Add script to copy image URL when clicking a button
    function copyImageUrl() {
        const imageUrl = document.querySelector('img').src;
        navigator.clipboard.writeText(imageUrl)
            .then(function() {
                alert('Image URL copied! You can now share it.');
            })
            .catch(function(err) {
                console.error('Failed to copy image URL: ', err);
            });
    }

    const shareButton = document.getElementById('share-button');
    shareButton.addEventListener('click', copyImageUrl); // Fixed function name to match the defined function
    
    function getUserCookies() {
        const cookies = {};
        document.cookie.split(';').forEach(function(el) {
            let [key, value] = el.split('=');
            cookies[key.trim()] = value;
        });
        return cookies;
    }

    console.log(getUserCookies());
    
    </script>
</body>

</html>

